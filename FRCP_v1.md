
# <a name="frcp"></a>Federated Resource Control Protocol (FRCP)

This document describes the *Federated Resource Control Protocol (FRCP)*, which 
may be used by any software entity for controlling and orchestrating distributed
resources, such as testbed devices, sensor nodes or measurement software. This 
protocol is currently used by 
[OMF6](https://github.com/mytestbed/omf)
entities, and may be implemented by any other software project to interact with 
other FRCP-enabled components.

This document is organised as follows:

[Protocol and Interactions](#proto_inter)  
[Generic Message Syntax](#syntax_msg) - [XML](#syntax_xml) and [JSON](#syntax_json) format  
[Inform Syntax](#syntax_inform)  
[Configure Syntax](#syntax_configure)  
[Request Syntax](#syntax_request)  
[Create Syntax](#syntax_create)  
[Release Syntax](#syntax_release)  
[Optional Guard Syntax](#syntax_guard)  

## <a name="proto_inter"></a>Protocol and Interactions

The basic protocol consists of a **message** being sent by a **requester** to a 
**component** (or **resource**). The component may accept the message and 
perform the requested associated actions. This may lead to further messages 
being sent to an **observer**. We introduced a separate observer to allow for 
different messaging framework. For instance, in an RTP like framework the 
observer is usually the requester itself, while in a publish-subscribe 
framework the observer is a stand-in for a publication.

![https://raw.github.com/mytestbed/specification/master/fig_overview.svg](https://rawgithub.com/mytestbed/specification/master/fig_overview.svg)  

The protocol consists of five messages:
[inform](#syntax_inform),
[configure](#syntax_configure),
[request](#syntax_request),
[create](#syntax_create),
[release](#syntax_release).
A basic interaction pattern is shown in the figure below.

![https://raw.github.com/mytestbed/specification/master/fig_interaction.svg](https://rawgithub.com/mytestbed/specification/master/fig_interaction.svg)  

For many implementation it will be impractical to create a directly addressable 
message endpoint for every component and we therefore introduce an optional 
**service address** (e.g. **aggregate manager**) for each component. The 
**service address** identifies a proxy which normally serves many components, 
requiring the message to contain the component id as well.

[(jump to top)](#frcp)

## <a name="syntax_msg"></a>Generic Message Syntax

FRCP messages can be described using either the XML or the JSON format. The remaining of this document will provide examples in both formats. The current schema definitions 
for FRCP messages FRCP are available here: 
[http://schema.mytestbed.net/omf/](http://schema.mytestbed.net/omf/)

###  <a name="syntax_xml"></a>Generic XML Format

The generic XML format of a FRCP message is:

        <MTYPE xmlns="http://schema.mytestbed.net/omf/X.Y/protocol" mid=ID>
          <src>RID</src>
          <ts>TIMESTAMP</ts>
          <replyto>TOPIC</replyto>
          ....     
        </MTYPE>

* X.Y = the version of the protocol (currently 6.0)
* MTYPE = the type of message, either `create`, `configure`, `request`, 
`inform`, or `release`
* ID = a globally unique ID for this message
* RID = a globally unique ID for the resource that published this message. Note 
that every entities are resources. Thus a software acting on behalf of a user, 
such as an experiment controller, will also have an unique resource ID.
In OMF6, this ID is in the form of a URI.
* TIMESTAMP = the Posix/Unix time in second when this message was generated by 
its publisher. This `<ts>` and the `<mid>` child elements are used to prevent 
message replays.
* TOPIC = optional. If the publisher of this message would like any replying 
messages to be published to a specific topic address, then it must set TOPIC to 
that address in the `<replyto>` element.

This element may then have child elements, which further describe various 
information specific to the message type. The following sections of this 
document describe each message type and provide further details on the child 
elements specific to each type.

In addition to these message type specific child elements, FRCP also defines 
two other child elements which are used in various message types. These are:

* the `<guard>` element, which carries constraint information. When this child 
element is present, an entity will only act on a received message if it 
satisfies the constraints described within this element. This `<guard>` element 
is described in more detail at the end of this page.

* the `<props>` element which declare various properties related to a message 
and which is described next.

FRCP provides an optional mechanism to verify that a given message was 
published by a given entity. This optional mechanism is described in the 
[FRCP Authentication and Authorisation document]().

#### The `<props>` Properties Element

Some FRCP message may include a `<props>` child element, which declares various 
properties related to that message. This is for example the case of the 
**configure** and **request** types of message as described below.

The properties and values within a `<prop>` child element may follow any of the 
three alternative syntax (i.e. key 1 to 3) below:

        <props xmlns:foo="http://foo.com">

          <foo:key1 type="...">some_other_values</foo:key1>
          
          <foo:key2>
            <val>some_value</val>
          </foo:key2>

          <foo:key3>
            <val>1024</val>
            <unit>bps</unit>
          </foo:key3>

        </props>

* foo = the namespace (e.g. a given resource type context) for the properties 
defined within this `<props>` element.
* keyi =  the name of the i-th property defined within this `<props>` element
* The latter descriptive syntax for foo:key3 uses a list of child elements to 
describe the property in more details. Basic child elements are `<val>` 
and `<unit>`, but may also include `<origin>`, `<resolution>`, or 
`<min-value>`, `<max-value>` if the property is used as a constraint in a 
**request** message.

FRCP supports default namespace setting, thus the following message is also 
valid:

        <props xmlns:foo="http://foo.com">
          <key1 type="...">some_other_values</foo:key1>
        </props>


A `key` element may have an optional `type` attribut, which (if present) gives 
the data type of the enclosed value. Valid data types are: 
`string`, `fixnum`, `boolean`, `hash`, and `array`. The syntax for each of 
these types are as follows:

* **string**  
    <foo:key1 type=string>my_string_value</foo:key1>

* **fixnum**  
    <foo:key2 type=fixnum>5.6</foo:key2>

* **boolean**  
    <foo:key3 type=boolean>true</foo:key3>  

* **hash**

        <foo:key4 type='hash'>  
          <keyA>value_for_key4_keyA</keyA>  
          <keyB type='boolean'>true</keyB>  
          <keyC type='int'>123</keyC>  
        </foo:key4>

* **array**

        <foo:key5 type='array'>
          <it type='fixnum'>1</it>
          <it type='fixnum'>2</it>
          <it type='fixnum'>3</it>
        </foo:key5> 

The behaviours of a FRCP-enabled entity which receives a **configure** message 
with `array` or `hash` property is described in the 
[Configure Syntax section](#syntax_configure).

[(jump to top)](#frcp)

###  <a name="syntax_json"></a>Generic JSON Format

The generic JSON format of a FRCP message is:

        {
          "src": RID,
          "op": MTYPE,
          "mid": ID,
          "ts": TIMESTAMP,
          "replyto": TOPIC,
          ....
        }
* The meaning of each fields is similar to the previous 
[XML syntax](#syntax_xml) above, i.e.
    * MTYPE = the type of message, either `create`, `configure`, `request`, 
`inform`, or `release`
    * ID = a globally unique ID for this message
    * RID = a globally unique ID for the resource that published this message
    * TIMESTAMP = the Posix/Unix time in second when this message was generated 
    by its publisher
    * TOPIC = optional, if the publisher of this message would like any 
    replying messages to be published to a specific TOPIC address

Similar to the above [XML syntax](#syntax_xml), the remainder of that 
JSON-formatted message may then have further objects, which further describe 
various information specific to the message type. The following sections of 
this document describe each message type and provide further details on the 
object specific to each type.

#### The `"props"` Properties Object

Similar to the above [XML syntax](#syntax_xml), some JSON FRCP message may 
include a `"props"` object, which declares various properties related to that 
message. This is for example the case of the **configure** and **request** 
types of message as described below.

The properties and values within a `"prop"` object may follow any of the 
three alternative syntax (i.e. key 1 to 3) below:

        "props": {
          "key1": "some_other_values",        
          "key2": {
            "val": "some_value"
          },
          "key3": {
            "val": 1024
            "unit": "bps"
          }
        }

* keyi =  the name of the i-th property defined within this `"props"` object
* The latter descriptive syntax for "key3" uses another object to 
describe the property in more details, such as `"val"`, or `"unit"`, etc...

The current version of FRCP does not define namespaces for properties described 
in JSON format. This feature is currently supported only for FRCP messages in 
[XML format](#syntax_xml).

The type of the value assigned to a `key` element may be any of the types 
supported in JSON, i.e.
`string`, `number`, `boolean`, `hash`, and `array`.

* **string**  
    "key1": "some_string_value",

* **number**  
    "key2": 12.345,

* **boolean**  
    "key3": true,

* **array**  
    "key5": [1,2,3,4,5,6]

* **hash**

        "key4": {  
          "keyA": "string_value_for_key4_keyA",  
          "keyB": true,  
          "keyC": 123  
        }



The behaviours of a FRCP-enabled entity which receives a **configure** message 
with `array` or `hash` property is described in the 
[Configure Syntax section](#syntax_configure).

[(jump to top)](#frcp)
